{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block extra_head %}
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .bar {
            fill: steelblue;
        }

        .label {
            font-size: 12px;
            fill: black;
        }
    </style>
{% endblock %}
{% block title %}{% trans "Statue" %}{% endblock %}

{% block main %}

    {% if not object %}
        <h3 class="mt-5">This statue is not yet available to view</h3>

    {% else %}
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <img class="card-img-top" src="{{ object.main_image }}" alt="Card image cap" id="image" />
                    <div class="card-body">
                        <h3>{{ object.name }}</h3>
                        <h3>Country: {{ object.country }} - {{ object.year }}</h3>
                        <div id="chart"></div>
                        <a href="{{ object.details_url }}" target="_blank">More details...</a>
                    </div>
                </div>
            </div>
        </div>

    {% endif %}

{% endblock %}

{% block js %}
    <script>


        $(document).ready(function() {

            {% if object.scored_count > 0 %}
                const data = [
                    { "response": "Like", "count": {{object.like_yes}}, "color": "green"  },
                    { "response": "Dislike", "count": {{object.like_no}}, "color": "red"  },
                    { "response": "Don't Know", "count": {{object.like_dontknow}}, "color": "yellow"  }
                ]


                // Set dimensions and margins for the chart
                const margin = { top: 20, right: 30, bottom: 40, left: 100 };
                const width = 600 - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                // Create SVG container
                const svg = d3.select("#chart")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // Set up scales
                const x = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.count)])  // Scale domain based on counts
                    .range([0, width]);

                const y = d3.scaleBand()
                    .domain(data.map(d => d.response))  // Map responses to band scale
                    .range([0, height])
                    .padding(0.1);  // Padding between bars

                // Add X-axis
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x).ticks(5))
                    .selectAll("text")
                    .style("font-size", "12px");

                // Add Y-axis
                svg.append("g")
                    .call(d3.axisLeft(y))
                    .selectAll("text")
                    .style("font-size", "12px");

                // Draw bars with animation
                svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", 0)
                    .attr("y", d => y(d.response))
                    .attr("width", 0)  // Initial width set to 0
                    .attr("height", y.bandwidth())
                     .attr("fill", d => d.color)
                    .transition()  // Add transition for animation
                    .duration(1000)  // Duration of animation in milliseconds
                    .attr("width", d => x(d.count));  // Final width after animation

                // Add labels to bars
                svg.selectAll(".label")
                    .data(data)
                    .enter()
                    .append("text")
                    .attr("class", "label")
                    .attr("x", 0)  // Start labels at the origin
                    .attr("y", d => y(d.response) + y.bandwidth() / 2)
                    .attr("dy", "0.35em")  // Vertically center the text
                    .text(d => d.count)
                    .transition()  // Add transition to match bar growth
                    .duration(1000)
                    .attr("x", d => x(d.count) + 5);  // Position at the end of the growing bar


            {% endif %}
        });
    </script>


{% endblock %}
